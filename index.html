<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Testing!</title>     <!-- Title of webpage -->           
	
		
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>   <!-- Leafet CSS --> 
		<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>   <!--Leaflet js --> 
		
		<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>   <!-- Turf js --> 
		
		<link rel="stylesheet" href="./leaflet-compass-master/dist/leaflet-compass.min.css" /> <!-- Leaflet compass CSS -->
		<script src='./leaflet-compass-master/dist/leaflet-compass.min.js'></script> <!-- Leaflet compass js -->
		
		<link rel="stylesheet" href="./leaflet-sidebar-master/src/L.Control.Sidebar.css" /> <!-- Leaflet sidebar  V1 CSS -->
		<script src='./leaflet-sidebar-master/src/L.Control.Sidebar.js'></script> <!-- Leaflet sidebar V1 js -->
		
		<link rel="stylesheet" href="./Leaflet.Legend-master/src/leaflet.legend.css" /> <!-- Leaflet legend CSS -->
		<script src='./Leaflet.Legend-master/src/leaflet.legend.js'></script> <!-- Leaflet legend js -->
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />  <!-- Change size to fit mobile browser --> 
		
		<style>
	  
      /* set the web page to full size */
			html, body {
				padding:0;
				margin: 0;
				width: 100%;
				height: 100%;
			}

      /* set the map to full page */
			#map {
				width: 100%;
				height: 85%;
			}

		</style>
	
	</head>
	
	<body style="background-color: MidnightBlue"> <!-- background colour --> 
	
	<body>
		
		<div id="sidebar">                  <!-- Sidebar (currently has only Goatfell in it) --> 
			<h1> Congratulations! You have reached Goatfell </h1>             <!-- Heading -->
			<p> Goat Fell (marked as Goatfell by the Ordnance Survey; Scottish Gaelic: Gaoda Bheinn) is the highest point on the Isle of Arran. At 874 metres (2,867 ft), it is one of four Corbetts on the island. The mountain, along with nearby Brodick Castle, is now owned by the National Trust for Scotland.The name is believed to mean 'Goat Mountain' (from the Norse geita).  </p> 
			<img src= "goatfell.jpg" alt = "Goatfell" width = "400" height = "345"> <!-- Add images like this -->
			<p> Due to the popularity of "Scotland in miniature" (Arran), Goat Fell is a very popular peak and there are many possible routes of ascent, some of which may be combined with visits to the summits of other nearby peaks. The most commonly used route, a constructed path of just over 3 miles (5 km) in length, starts from near Brodick Castle in Cladach. Initially the path leads up through the forested grounds of the castle, passing many rhododendron bushes. At just under 1,000 ft (300 m) above sea level the path leaves the forestry, and the route continues through bare moorland, reaching the summit by way of the east ridge of the mountain. There is a viewpoint table at the summit: on a clear day Northern Ireland may be seen.Goatfell summit on a clear day.An alternative shorter and steeper route comes up from the village of Corrie. This route joins the main path on the east ridge. Goat Fell may also be climbed from the north, where it is linked by a ridge to the subsidiary top of North Goatfell, a point from which three ridges radiate. In addition to the ridge leading south to the main summit, there is a ridge heading northeast, providing some very easy scrambling as it passes over Cìoch na h-Òighe (the Young Maiden's Breast). Finally, the western ridge drops down to a bealach known as The Saddle, before climbing again towards the summit of Cìr Mhòr. The right-of-way between Glen Rosa and Glen Sannox passes over The Saddle.The mountain was the scene of the death of English tourist Edwin Rose who was murdered by John Watson Laurie in 1889 on the mountain. Laurie was sentenced to death, later commuted to a life sentence and spent the rest of his life in prison.[1]
		</div> 
		
		<h1 style= 'font-size: 20px; font-family: Arial; color:white; text-align: center; margin-bottom: -10px'>A location based game</h1>     <!--style changes the look of the text-->                          
		<p style='font-size:20px; font-family: Arial; color:white'>Sites visited:</p>
		<p style='font-size:20 px; color:white; font-family: Arial'id="score"></p>			<!--Score-->
		<div id='map'></div>        <!--Map-->
		
		<div id="sidebar_two">                  <!-- Sidebar two --> 
			<h1> Settings </h1> 
			<p> How to play: </p> 
			<hr> 
			<p> Something else </p>
		</div> 
		
		<script>
			
			var loc = null;  // Location variable       
			
			//COUNTER FOR SCORING SYSTEM 					
			let geofence_tracker = [0,0,0,0,0,0];  // Create array with each geofence set to zero 
			
			
			//alert("welcome to the Isle of Arran! \n In order to continue please enable location ");     //Alert shown when webpage is opened 
			
			var myStyle = {     // Style for geofences 
				"color": "FF0000",
				"weight": 5,
				"opacity": 0.35
			};
			
			
			//CREATE MAP 
			const map = L.map('map');
			const mapCentre = L.latLng(53.805136, -1.840275);
			map.setView(mapCentre, 14);
			const tiles = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'});
			tiles.addTo(map); // Add tiles to map 
			
			// ADD LOCATE 
			map.locate({setView: false, maxZoom: 14, watch: true});			//Add geolocation watch = true means location is constantly watched rather than detected once  
	
			//ADD COMPASS 
			map.addControl( new L.Control.Compass({ position: 'topleft', showDigit:true}) );   // Add compass to map (using plugin)  

			// ADD SIDEBAR TO DISPLAY INFORMATION ABOUT SITES 
			var sidebar = L.control.sidebar ('sidebar', {         // Add sidebar to map 
				position: 'left'
			}); 
			map.addControl(sidebar); 
			
			// ADD SIDEBAR WITH ADDITIONAL INFORMATION 
			var sidebar_two = L.control.sidebar('sidebar_two', {
				position: 'right' 
			}); 
			map.addControl(sidebar_two); 
			sidebar_two.show();
			
			///////FUNCTION FOR GEOLOCATION//////////
			function onLocationFound(e) {                 // Create function for geolocation
				var radius = e.accuracy;
				
				geopoint = turf.point([e.latlng.lng, e.latlng.lat]);		//Create turf point at geolocation 	 
				
				var redIcon = L.icon({    //create icon  
					iconUrl: 'youarehere.png',  //https://www.flaticon.com/search?word=you%20are%20here  //icon URL 
					iconSize: [57,57],    // Size of icon 
					iconAnchor: [26, 57],  // icon (usually half and same)
					popupAnchor: [0,-57],
				})
				
				if (loc == null) {                        // Create a new marker
					loc = L.marker(e.latlng, {icon:redIcon}).addTo(map);
				} else { 
					loc.setLatLng(e.latlng); // update marker as position changes
				}
				
				//USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN OUTER GEOFENCE (AND THEREFORE PROVIDES DIRECTIONS)
				const outerbufferList = [outer_geofence6, outer_geofence5, outer_geofence4, outer_geofence3, outer_geofence2, outer_geofence1];      // Store poly(buffers) in an array 
				for ( let i = 0; i < outerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, outerbufferList[i])) {						// if current location is within geofence
						loc.bindPopup("<b>Getting close!</b><br> In the future directions will appear here").openPopup();		// add a popup to the marker created on line 54  
					}  
				}
				
				//USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN INNER GEOFENCE (AND THEREFORE PROVIDES INFORMATION ABOUT SITE)
				const innerbufferList = [inner_geofence1,inner_geofence2, inner_geofence3, inner_geofence4, inner_geofence5, inner_geofence6];      // Store poly(buffers) in an array
				for ( let i = 0; i < innerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, innerbufferList[i])) {					// if current location is within geofence
						loc.bindPopup("<b>Well done you found the site!</b><br> In the future information will be displayed here.").openPopup();		// add a popup to the marker created on line 54  
						if ( geofence_tracker [i] == 0) {     // If current geofence tracker value is 0 
							geofence_tracker[i] = 1; 		// Change tracker to 1 
							points = 0;      //Add point to rewards  
							for(let j in geofence_tracker) { points += geofence_tracker[j]; } // for each site in geofence  tracker, points = geofence tracker 
							document.getElementById("score").innerHTML = points; //Display rewards on interface 
							sidebar.show();                              // Show sidebar when in geofence 
							goatfell_marker.on('click', function () {    // Click marker to show sidebar (FIX THIS) 
								sidebar.show();  
							}); 
							
							}
					} else { 
					}
				}
			}
			
			/////ICON CLASS FOR CUSTOM ICONS////
			var arranIcon = L.Icon.extend({
				options: {
					iconSize: [37,37],   //Set icon size 
					iconAnchor: [26, 37], // Set icon anchor
					popupAnchor: [-5, -37] // Set popup anchor 
				}
			});
			 
			var goatfell = new arranIcon({iconUrl:'mountain.png'}),       // Remember to reference icons in final thing
				drumadoonsill = new arranIcon({iconUrl: 'landslide.png'}),  // Add each new icon to class using URL 
				corriesandstone = new arranIcon({iconUrl: 'sailboat.png'}),
				glenrosa = new arranIcon({iconUrl: 'river.png'}),
				huttonsunconformity = new arranIcon({iconUrl: 'tower.png'}),
				kildonandykes = new arranIcon({iconUrl: 'sunset.png'}); // Semi colon on last one
			
			//CREATE FIRST SITE//							
			var site_one = turf.point([-1.833031,53.805585]);					 // Turf point 
			let inner_geofence1 = turf.buffer(site_one, 0.9, {units: 'miles', steps: 32}); 	// Add inner buffer //Change steps to make buffer rounder 
			let outer_geofence1 = turf.buffer(site_one, 0.1, {units: 'miles', steps: 32}); // Add outer buffer 
			var goatfell_marker = L.marker([53.805585,-1.833031], {icon:goatfell}).bindPopup("Goatfell").addTo(map);     // Add custom icons as regular markers (didnt really need turf for this bit)
			L.geoJSON(inner_geofence1).addTo(map); 									// Add inner buffer to map 
			L.geoJSON(outer_geofence1, {style: myStyle}).addTo(map); 			// Add outer buffer with style 
				
			//CREATE SECOND SITE///
			var site_two = turf.point([-1.833460,53.813846]);					 // Turf point 
			let inner_geofence2 = turf.buffer(site_two, 0.1, {units: 'miles', steps:32}); 	// Add inner buffer
			let outer_geofence2 = turf.buffer(site_two, 0.1, {units: 'miles', steps:32}); // Add outer buffer 
			L.marker([53.813846,-1.833460], {icon:drumadoonsill}).bindPopup("Drumadoon Sill").addTo(map); // Add custom icon as regular marker 
			L.geoJSON(inner_geofence2).addTo(map); 									// Add inner buffer to map 
			L.geoJSON(outer_geofence2, {style: myStyle}).addTo(map); 			// Add outer buffer to map with style 
				
				
			//CREATE THIRD SITE//
			var site_three  = turf.point([-1.848824, 53.816050]); // Turf point 
			let inner_geofence3 = turf.buffer(site_three, 0.1, {units:'miles', steps:32}); // Add inner buffer 
			let outer_geofence3 = turf.buffer(site_three, 0.1, {units: 'miles',steps:32 }); // Add outer buffer
			L.marker([53.816050,-1.848824], {icon:corriesandstone}).bindPopup("Corrie sandstone").addTo(map); // Add custom icon 
			L.geoJSON(inner_geofence3).addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence3, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style
				 
				
			///CREATE FORTH SITE////////
			var site_four  = turf.point([ -1.855304, 53.806041]);               // Turf point
			let inner_geofence4 = turf.buffer(site_four, 0.1, {units:'miles',steps:32});   // Add inner buffer 
			let outer_geofence4 = turf.buffer(site_four, 0.1,{units: 'miles',steps:32});    // Add outer buffer
			L.marker([53.806041,-1.855304], {icon:glenrosa}).bindPopup("Glen Rosa").addTo(map);  // Add custom icon 
			L.geoJSON(inner_geofence4).addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence4, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above 
				 
				
			///////CREATE FIFTH SITE////////
			var site_five  = turf.point([-1.831529,53.818457]);               // Turf point
			let inner_geofence5 = turf.buffer(site_five, 0.1, {units:'miles', steps:32});   // Add inner buffer 
			let outer_geofence5 = turf.buffer(site_five, 0.1,{units: 'miles', steps:32});    // Add outer buffer
		    L.marker([53.818457, -1.831529], {icon: huttonsunconformity}).bindPopup("Hutton's Unconformity").addTo(map); //Add custom icon   
			L.geoJSON(inner_geofence5).addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence5, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above
				
				
			////CREATE SIXTH SITE///////
			var site_six  = turf.point([-1.826278, 53.810118]);               // Turf point
			let inner_geofence6 = turf.buffer(site_six, 0.1, {units:'miles', steps:32});   // Add inner buffer 
			let outer_geofence6 = turf.buffer(site_six, 0.1,{units: 'miles', steps:32});    // Add outer buffer
			L.marker([53.810118,-1.826278], {icon: kildonandykes}).bindPopup("Kildonan Dykes").addTo(map);  // Add custom icon
			//var marker_six = L.geoJSON(site_six).bindPopup("site 6").addTo(map); 	// Add point to map as marker 
			L.geoJSON(inner_geofence6).addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence6, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above 
							
			// CALL LOCATION FUNCTION 		
			map.on('locationfound', onLocationFound); 
			
			// ADD FAILED GEOLOCATION FUNCTION 
			function onLocationError(e) {     // Add function in the event of failed geolocation //seems to work even if location is found ? 
				alert(e.message); 
			} 
			map.on('locationerror', onLocationError); 
			
			//ADD LEGEND 
			L.control.Legend({           // Add legend to map 
				position: "bottomright", 
				legends: [{ 
					label : "Goatfell", 
					type: "image", 
					url: "mountain.png",  
				}]
			}).addTo(map); 
	</script>
	</body>
</html>
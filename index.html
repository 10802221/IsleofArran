<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Testing</title>     <!-- Title of webpage -->           
	
 		
		
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>
		<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
		<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>
		
		
		<style>
	  
      /* set the web page to full size */
			html, body {
				padding: 0;
				margin: 0;
				width: 100%;
				height: 100%;
			}

      /* set the map to full page */
			#map {
				width: 100%;
				height: 100%;
			}
		</style>
	
	</head>
	<body>

    <!-- A division to hold the map -->
		
		<h2 style= 'font-size: 30px'>A location based game</h2>                               
		<p style='font-size:30px'>Sites visited:</p>
		<p style='font-size:30px'id="score"></p>			<!--Score-->
		<div id='map'></div>        <!--Map-->
	
		
		<script>
		
			//alert("welcome to the Isle of Arran! \n In order to continue please enable location ");     //Alert shown when webpage is opened 
			var myStyle = {                       // Style for geofences 
				"color": "FF0000",
				"weight": 5,
				"opacity": 0.35
			};
			
			
			// this is a variable that holds the map
			const map = L.map('map');

			// this is a variable that holds the coordinates of the map centre
			const mapCentre = L.latLng(53.856619,-1.786854);

			// set the map to use the above coordinates, and to zoom level 16
			map.setView(mapCentre, 14);

			// this is a variable that holds a reference the tiles that will be used for the basemap
			const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});

			//add the tiles to the map
			tiles.addTo(map);
			
		    map.locate({setView: true, maxZoom: 14});			//Add geolocation 
			
			var points = 0;        // Scoring system defined outside function so it doesnt get overwritten 
			
			///////FUNCTION FOR GEOLOCATION//////////
			function onLocationFound(e) {                 // Create function for geolocation
				var radius = e.accuracy;
				var redIcon = L.icon({
					iconUrl: 'youarehere.png',  //https://www.flaticon.com/search?word=you%20are%20here
					iconSize: [52,57], 
					iconAnchor: [16, 37],
			}); 
				
				var loc = L.marker(e.latlng, {icon: redIcon}).addTo(map);					//Add geolocation to map as a marker 		
				
				let geopoint = turf.point([e.latlng.lng, e.latlng.lat]);		//Create turf point at geolocation
				
				//CREATE FIRST SITE//							
				var site_one = turf.point([-1.784279,53.862010]);					 // Turf point 
				let inner_geofence1 = turf.buffer(site_one, 0.05, {units: 'miles'}); 	// Add inner buffer 
				let outer_geofence1 = turf.buffer(site_one, 0.1, {units: 'miles'}); // Add outer buffer 
				var marker_one = L.geoJSON(site_one).bindPopup("site 1").addTo(map);  // Add point to map as buffer 
				L.geoJSON(inner_geofence1).addTo(map); 									// Add inner buffer to map 
				L.geoJSON(outer_geofence1, {style: myStyle}).addTo(map); 			// Add outer buffer with style 
				
				//CREATE SECOND SITE///
				var site_two = turf.point([-1.786854,53.856619]);					 // Turf point 
				let inner_geofence2 = turf.buffer(site_two, 0.05, {units: 'miles'}); 	// Add inner buffer
				let outer_geofence2 = turf.buffer(site_two, 0.1, {units: 'miles'}); // Add outer buffer 
				var marker_two = L.geoJSON(site_two).bindPopup("site 2").addTo(map); // Add point to map as marker
				L.geoJSON(inner_geofence2).addTo(map); 									// Add inner buffer to map 
				L.geoJSON(outer_geofence2, {style: myStyle}).addTo(map); 			// Add outer buffer to map with style 
				
				
				//CREATE THIRD SITE//
				var site_three  = turf.point([-1.803591, 53.848721]); // Turf point 
				let inner_geofence3 = turf.buffer(site_three, 0.05, {units:'miles'}); // Add inner buffer 
				let outer_geofence3 = turf.buffer(site_three, 0.1, {units: 'miles' }); // Add outer buffer
				var marker_three = L.geoJSON(site_three).bindPopup("site 3").addTo(map); // Add point to map as marker
				L.geoJSON(inner_geofence3).addTo(map); 										// Add inner buffer to map 
				L.geoJSON(outer_geofence3, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style
				 
				
				///CREATE FORTH SITE////////
				var site_four  = turf.point([ -1.855304, 53.806041]);               // Turf point
				let inner_geofence4 = turf.buffer(site_four, 0.1, {units:'miles'});   // Add inner buffer 
				let outer_geofence4 = turf.buffer(site_four, 0.1,{units: 'miles'});    // Add outer buffer
				var marker_four = L.geoJSON(site_four).bindPopup("site 4").addTo(map); 	// Add point to map as marker 
				L.geoJSON(inner_geofence4).addTo(map); 										// Add inner buffer to map 
				L.geoJSON(outer_geofence4, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above 
				 
				
				///////CREATE FIFTH SITE////////
				var site_five  = turf.point([-1.831529,53.818457]);               // Turf point
			    let inner_geofence5 = turf.buffer(site_five, 0.1, {units:'miles'});   // Add inner buffer 
				let outer_geofence5 = turf.buffer(site_five, 0.1,{units: 'miles'});    // Add outer buffer
				var marker_five = L.geoJSON(site_five).bindPopup("site 5").addTo(map); 						// Add point to map as marker 
				L.geoJSON(inner_geofence5).addTo(map); 										// Add inner buffer to map 
				L.geoJSON(outer_geofence5, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above
				
				
				////CREATE SIXTH SITE///////
				var site_six  = turf.point([-1.826278, 53.810118]);               // Turf point
			    let inner_geofence6 = turf.buffer(site_six, 0.1, {units:'miles'});   // Add inner buffer 
				let outer_geofence6 = turf.buffer(site_six, 0.1,{units: 'miles'});    // Add outer buffer
				var marker_six = L.geoJSON(site_six).bindPopup("site 6").addTo(map); 	// Add point to map as marker 
				L.geoJSON(inner_geofence6).addTo(map); 										// Add inner buffer to map 
				L.geoJSON(outer_geofence6, {style: myStyle}).addTo(map); 				// Add outer buffer to map using style defined above 
							
				
				////USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN OUTER GEOFENCE (AND THEREFORE PROVIDES DIRECTIONS)
				const outerbufferList = [outer_geofence6, outer_geofence5, outer_geofence4, outer_geofence3, outer_geofence2, outer_geofence1];      // Store poly(buffers) in an array 
				for ( let i = 0; i < outerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, outerbufferList[i])) {						// if current location is within geofence
						loc.bindPopup("<b>Getting close!</b><br> In the future directions will appear here").openPopup();		// add a popup to the marker created on line 54  
					} else {
						//loc.bindPopup("Keep looking!").openPopup(); 						// otherwise add message of encouragement   
					}
				}
				
				
				////USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN INNER GEOFENCE (AND THEREFORE PROVIDES INFORMATION ABOUT SITE)
				const innerbufferList = [inner_geofence1,inner_geofence2, inner_geofence3, inner_geofence4, inner_geofence5, inner_geofence6];      // Store poly(buffers) in an array
				for ( let i = 0; i < innerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, innerbufferList[i])) {						// if current location is within geofence
						loc.bindPopup("<b>Well done you found the site!</b><br> In the future information will be displayed here.").openPopup();		// add a popup to the marker created on line 54 
						//var points = 0;   //Attempt at a scoring system
						points += 1;      //Add point to rewards
						document.getElementById("score").innerHTML = points; //Display rewards on interface 
					} else { 
					//	loc.bindPopup("where are you?").openPopup(); 	// otherwise add message of encouragement   
					}
				}
				
				
			};
			
			map.on('locationfound', onLocationFound);
			
			
		</script>
	</body>
</html>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Testing v0.1.0</title>              
	
		
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"/>   <!-- Leafet CSS --> 
		<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>   <!--Leaflet js --> 
		
		<script src='https://unpkg.com/@turf/turf@6.3.0/turf.min.js'></script>   <!-- Turf js --> 
		
		<link rel="stylesheet" href="./leaflet-sidebar-master/src/L.Control.Sidebar.css" /> <!-- Leaflet sidebar  V1 CSS -->
		<script src='./leaflet-sidebar-master/src/L.Control.Sidebar.js'></script> <!-- Leaflet sidebar V1 js -->
		
		<link rel="stylesheet" href="./Leaflet.Legend-master/src/leaflet.legend.css" /> <!-- Leaflet legend CSS -->
		<script src='./Leaflet.Legend-master/src/leaflet.legend.js'></script> <!-- Leaflet legend js -->
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />  <!-- Change size to fit mobile browser --> 
		
		<style>
	  
      /* set the web page to full size */
			html, body {
				padding:0;
				margin: 0;
				width: 100%;
				height: 100%;
			}

      /* set the map to full page */
			#map {
				width: 100%;
				height: 85%;
			}
			
			#toggle {
				line-height: 30px;
				width: 60px; 
				margin-top: 50px;
				margin-right: 10px;
				position: absolute;
				top: 0;
				right: 0; 
				background-color: white; 
			}
			
			.figureborder { 
				border-style: solid; 
				border-color:#FF2D00;
				padding: 2px;
				border-width: thin; 
				background-color: #F9E5E1;  
			} 
			
			.introborder { 
				border-style: solid; 
				border-color: #50B309; 
				padding: 2px; 
				border-width: thin; 
				background-color:#E6FBD7;
			}
			
			
		</style>
	
	</head>
	
	<body style="background-color: MidnightBlue"> <!-- background colour --> 
	
	<body>
		
		<h1 style= 'font-size: 20px; font-family: Arial; color:white; text-align: center; margin-bottom: -10px;'>Arran Geology </h1>     <!--style changes the look of the text-->                          
		
		<button type= "button" id= "toggle">Menu</button>   <!-- Create button to toggle sidebar -->
		
		<br>    <!-- Create some space between title and map --> 
		<br> 
		
		<p style="color:white; font-family:Arial"> Distance to geosite (miles):</p><p id='distance' style="color:white; font-family:Arial"></p> <!-- Display distance to site when geofence is entered --> 
		
		<div id='map'></div>        <!--Map-->
		
		<div id="sidebar_settings">                  <!-- Sidebar --> 
			<h1 style="background-color:#B8E0E6;"> Score</h1> 				<!-- currently contains miscellaneous stuff --> 
			<p style="text-align:center;"><b> Sites visited:</b></p>
			<p id="score" style="text-align: center;"></p>
			<hr>
			<h1 style="background-color:#B8E0E6;"> How to play: </h1> 
			<p> 1. Geosites are numbered in order from 1 to 6. <br> 2. When a geosite is nearby, distance will be displayed.<br> 3. Once in the boundary of the geosite, information will be displayed. <br> 4. The colour of the boundary will change from grey to green. <br> 5. Your score above will increase as you visit each site. <br> 6. Change all sites to win!</p> 
		</div> 
		
	
		
		<script>
			
			var loc = null;  // Location variable       
			
			//COUNTER FOR SCORING SYSTEM 					
			let geofence_tracker = [0,0,0,0,0,0];  // Create array with each geofence set to zero 
			
			
			//alert("Welcome to the Isle of Arran!\nThis game has been developed to allow you to learn about the island's geodiversity on the go.\nIn order to continue please enable location.\nFurther instructions on how to play are shown in the menu.\n Enjoy!");     //Alert shown when webpage is opened 
			
			
			
			var outerStyle = {     // Style for geofences 
				"color": "#e6e6e6",
				"weight": 2,
				"fillOpacity": 0.5
			};
			
			var innerStyle = {
				"color": "#a8a8a8", 
				"weight": 2, 
				"fillOpacity":0.5
			};
			
			var enterstyle = { 
				"color": "#2C9815 ",
				"weight": 3,
				"fillOpacity": 0.5
			};
			
			
			//CREATE MAP 
			const map = L.map('map');
			const mapCentre = L.latLng(53.792502, -1.755063);
			map.setView(mapCentre, 14);
			const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'});
			tiles.addTo(map); // Add tiles to map 
			
			// ADD LOCATE 
			map.locate({setView: false, maxZoom: 14, watch: true});			//Add geolocation watch = true means location is constantly watched rather than detected once    
			
			// ADD SIDEBAR WITH SETTINGS INFORMATION 
			var sidebar_settings = L.control.sidebar('sidebar_settings', {
				position: 'right' 
			}); 
			map.addControl(sidebar_settings);    // Add sidebar 
			
			document.getElementById("toggle").onclick = Toggle; // Link toggle button to sidebar 
			
			function Toggle () { 
				sidebar_settings.toggle(); // Function to toggle sidebar 
			}
			
			
			///////FUNCTION FOR GEOLOCATION//////////
			function onLocationFound(e) {                 // Create function for geolocation
				var radius = e.accuracy;
				
				geopoint = turf.point([e.latlng.lng, e.latlng.lat]);		//Create turf point at geolocation 	 
				
				var redIcon = L.icon({    //create icon  
					iconUrl: 'youarehere.png',  //https://www.flaticon.com/search?word=you%20are%20here  //icon URL 
					iconSize: [37,37],    // Size of icon 
					iconAnchor: [17, 37],  // icon (usually half and same)
					popupAnchor: [0,-37],
				})
				
				if (loc == null) {                        // Create a new marker
					loc = L.marker(e.latlng, {icon:redIcon}).addTo(map);
				} else { 
					loc.setLatLng(e.latlng); // update marker as position changes
				}
				
				//USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN OUTER GEOFENCE (AND THEREFORE PROVIDES DIRECTIONS)
				const outerbufferList = [outer_geofence6, outer_geofence5, outer_geofence4, outer_geofence3, outer_geofence2, outer_geofence1];      // Store poly(buffers) in an array 
				
				const geositelist = [site_one, site_two, site_three, site_four, site_five, site_six]; //List of geosites (turf points) 
				
				for ( let i = 0; i < outerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, outerbufferList[i])) {						// if current location is within geofence
						options = {units:'miles'}; 
						var distance = turf.distance(geopoint,geositelist[i],options);  //Calculate and display distance to geosite 
						var r_distance = Math.round(distance*100)/100; 	                 // Round distance to 2 sig figs
						document.getElementById("distance").innerHTML = r_distance; 
						//var path = turf.shortestPath(geopoint, geositelist[i]);                      // Show path (currently doesn't work)
						//var l_path = L.geoJSON(path).addTo(map);     //Shows path to nearest geosite not actual geosite 
						//loc.bindPopup(get("distance")).openPopup(); 	
				}
			}	
				//USE FOR LOOP TO CHECK IF CURRENT LOCATION IS WITHIN INNER GEOFENCE (AND THEREFORE PROVIDES INFORMATION ABOUT SITE)
				const innerbufferList = [inner_geofence1,inner_geofence2, inner_geofence3, inner_geofence4, inner_geofence5, inner_geofence6];      // Store poly(buffers) in an array
				
				const popups = [g_popup, ds_popup, cs_popup, gr_popup, hc_popup, kd_popup];   // Array of markers (with popups attached) 
				
				for ( let i = 0; i < innerbufferList.length; i++) {      // For each item in the array 
					if (turf.booleanWithin(geopoint, innerbufferList[i])) {					// if current location is within geofence
						popups[i].openPopup();     //Open relevant popup  
						
						if ( geofence_tracker [i] == 0) {     // If current geofence tracker value is 0 
							geofence_tracker[i] = 1; 		// Change tracker to 1 
							points = 0;      //Add point to rewards  
							for(let j in geofence_tracker) { points += geofence_tracker[j]; } // for each site in geofence  tracker, points = geofence tracker 
							document.getElementById("score").innerHTML = points; //Display rewards on interface 
							L.geoJSON(innerbufferList[i], {style:enterstyle}).addTo(map); //Change colour of geofence to show you have been there
						}
					}  
				} 
			}
			
			
			
			/////ICON CLASS FOR CUSTOM ICONS////
			var arranIcon = L.Icon.extend({
				options: {
					iconSize: [37,37],   //Set icon size 
					iconAnchor: [26, 37], // Set icon anchor
					popupAnchor: [-5, -37] // Set popup anchor 
				}
			});
			 
			var goatfell = new arranIcon({iconUrl:'two.png'}),       // <div>Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
				drumadoonsill = new arranIcon({iconUrl: 'five.png'}), // <div>Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
				corriesandstone = new arranIcon({iconUrl: 'three.png'}),  // <div>Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
				glenrosa = new arranIcon({iconUrl: 'one.png'}),                  // <div>Icons made by <a href="http://www.google.com" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
				huttonsunconformity = new arranIcon({iconUrl: 'four.png'}), // <div>Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
				kildonandykes = new arranIcon({iconUrl: 'six.png'}); // Semi colon on last one //<div>Icons made by <a href="https://www.flaticon.com/authors/google" title="Google">Google</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
			
			//CREATE FIRST SITE//	//GOATFELL    						
			var site_one = turf.point([-1.747301,53.793542]);					 // Turf point 
			let inner_geofence1 = turf.buffer(site_one, 0.3, {units: 'miles', steps: 32}); 	// Add inner buffer //Change steps to make buffer rounder 
			let outer_geofence1 = turf.buffer(site_one, 0.1, {units: 'miles', steps: 32}); // Add outer buffer 
			var g = L.marker([53.793542, -1.747301], {icon:goatfell}).addTo(map);     // Add custom icons as regular markers (didnt really need turf for this bit)
			L.geoJSON(inner_geofence1, {style:innerStyle}).addTo(map); 									// Add inner buffer to map 
			L.geoJSON(outer_geofence1, {style: outerStyle}).addTo(map); 			// Add outer buffer with style 
			//create content for Goatfell 
			var g_popupContent = ("<h1> Well done! You found Goatfell! </h1><b> Dominant rock type:</b> Granite</p><b> Periods: </b> Palaeogene (66-23.02 million years ago), Quaternary (2.5 million years ago)</p> </b> <p>Goatfell (Gaoda Bheinn) is the highest peak on Arran, standing at 874m at the summit. Goatfell started life as a volcano and was shaped into its current form by glaciers during the last ice age. </p> <img src= 'goatfell_hillshade_2.PNG'/><p class='figureborder' style='text-align: center'> This map shows the North Arran Mountains, encompassing Goatfell and its surroundings.</p> <p> The North Arran Mountains were formed by a granite pluton forcing its way through Northern Arran. Plutons form when magma rise through the crust into dome shaped intrusions which are then exposed over time by erosion.</p><img src='insert_diagram_here.JPG' /><p class='figureborder' style= 'text-align: center'> Diagram caption here. </p><p>Of course, today the mountains are no longer domed shaped, having been shaped by Quaternary glaciation. The angular peaks of Goatfell display great examples of erosional features. Two particularly visible on the map are aretes and corries.</p> <img src='Goatfell_Corries.PNG'/> <p class='figureborder' style='text-align: center'> An arete and several corries are labelled here, on the east side of the mountain range. </p> </p> Corries are circular depressions which form as accumulated snow in hollows turns to ice. As the ice moves downhill, the bottom of the hollow is eroded. This erosion is uneven and causes a lip to form. When two corries erode back to back, an arete, a narrow ridge is formed. </p>")   //Add content using HTML tags 
			var g_popup = g.bindPopup(g_popupContent, { //Note to self- don't use double quotes with classes 
				maxWidth: 320, 
				maxHeight: 400,// Makes sure popups accomadate photos 
				keepInView:false
			});    
			g.off('click'); 
			
			
			//CREATE SECOND SITE//    //Drumadoon Sill 
			var site_two = turf.point([ -1.749468,53.795779]);	   				 // Turf point 
			let inner_geofence2 = turf.buffer(site_two, 0.05, {units: 'miles', steps:32}); 	// Add inner buffer
			let outer_geofence2 = turf.buffer(site_two, 0.1, {units: 'miles', steps:32}); // Add outer buffer 
			var ds = L.marker([53.795779,-1.749468], {icon:drumadoonsill}).addTo(map); // Add custom icon as regular marker 
			L.geoJSON(inner_geofence2, {style: innerStyle}).addTo(map); 									// Add inner buffer to map 
			L.geoJSON(outer_geofence2, {style: outerStyle}).addTo(map); 			// Add outer buffer to map with style 
			//Create content for Drumadoon Sill 	
			var ds_popupContent = ("<h1> Well done! You found Drumadoon Sill! </h1><b> Dominant rock type:</b> Felsite </p><b> Periods: </b> Palaeogene (66-23.02 million years ago) </p> <p>Drumadoon Sill represents an igneous intrusion which forms part of a larger network of igneous features on the island.</p> <img src='sill_geology.JPG'/> <p class='figureborder' style='text-align:center'> The intrusion of felsite can be seen here, surrounded by sedimentary rock.</p> <p> Sills are formed when volcanic magma intrudes between two layers of pre-exisitng sandstone. This is visible on the geology map where felsite intrudes the surrounding sandstone. The magma here originated from the same volcanic centre as the Northern Mountains and was intruded horizonally (remember window sills!).</P> <img src ='sill_cross_section.JPG'/> <p class='figureborder' style='text-align:center'> The shape of the sill can be seen in this cross profile. </p> <img src='insert_diagram_here.JPG' /> <p class='figureborder' style= 'text-align:center'> Diagram caption here. </p> <p> Weathering of the surrounding softer sandstone led to the exposure of the volcanic rock as a sheer cliff, as can be seen in the cross section. The hexagon vertical columns (known as columnar joining) are a result of the presence of Quartz and Felspar and form during the cooling process. Similar columns can be seen at the Giant's Causeway and on the island of Staffa. </p>")   //Add content using HTML tags 
			var ds_popup = ds.bindPopup(ds_popupContent, { 
				maxWidth: 320, // Makes sure popups accomadate photos 
				maxHeight: 400
			});
			ds.off('click'); 
		
			//CREATE THIRD SITE//     //Corrie Sandstone 
			var site_three  = turf.point([ -1.759085,53.791152]); // Turf point 
			let inner_geofence3 = turf.buffer(site_three, 0.05, {units:'miles', steps:32}); // Add inner buffer 
			let outer_geofence3 = turf.buffer(site_three, 0.1, {units: 'miles',steps:32 }); // Add outer buffer
			var cs = L.marker([53.791152,-1.759085], {icon:corriesandstone}).addTo(map); // Add custom icon 
			L.geoJSON(inner_geofence3,{style: innerStyle}) .addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence3, {style: outerStyle}).addTo(map); 				// Add outer buffer to map using style
			//Create content for Corrie Sandstone 
			var cs_popupContent = ("<h1> Well done! You found Corrie Sandstone! </h1><b> Dominant rock type: </b> Old red sandstone, Carboniferous rocks </p> <b> Periods: </b> Devonian (419-358 million years ago), Carboniferous (358-298 million years ago) </p> <p>This section of coastline at Corrie (An Coire) represents millions of years of geological time on Arran. The layers of rock present here help provide an indication of the past conditions of the island.</p> <img src= 'CorrieSandstoneGeology.PNG'/> <p class='figureborder' style='text-align:center'> This geological map provides a snapshot of the variety of rocks in the area. </p> <p> The red sandstone here resembles sand dunes present on earth today and were formed when Arran consisted of its own desert. Dry conditions prevailed when Arran was located at a similar latitiude as the Sahara is now. Sand was deposited in a large desert and shaped by strong winds. The rocks are a distinctive red colour due to Iron Oxide. </p> <img src='sandstone_photo.jpg'/> <p class='figureborder' style='text-align:center'> Similar shapes to sand dunes can be observed in this image. </p><p> Conglomerates present were formed when eroded sediment from the nearby Caladonian mountains was washed into the area by flooding. The lava represents a Carboniferous lava flow. Overall the red sandstone and Carboniferous rocks represent very different geological time periods with harsh conditions in the former and more tropical conditions in the latter.</p>")   //Add content using HTML tags 
			var cs_popup = cs.bindPopup(cs_popupContent, { 
				maxWidth: 320, 				// Makes sure popups accomadate photos
				maxHeight: 400,
			});
			cs.off('click');
			
			//CREATE FORTH SITE// 	//Glen Rosa
			var site_four  = turf.point([-1.755351,53.795563]);               // Turf point
			let inner_geofence4 = turf.buffer(site_four, 0.05, {units:'miles',steps:32});   // Add inner buffer 
			let outer_geofence4 = turf.buffer(site_four, 0.1,{units: 'miles',steps:32});    // Add outer buffer
			var gr = L.marker([53.795563,-1.755351], {icon:glenrosa}).bindPopup("Glen Rosa").addTo(map);  // Add custom icon 
			L.geoJSON(inner_geofence4,{style: innerStyle}) .addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence4,{style: outerStyle}).addTo(map);				// Add outer buffer to map using style defined above 
			// Create content for Glen Rosa
			var gr_popupContent = ("<h1> Well done! You found Glen Rosa!</h1><b> Dominant rock type: </b> Granite </p> <b> Periods: </b> Palaeogene (66-23.03 million years ago), Quaternary (2.6 million years ago) </p> <P> Glen Rosa (Gleann Rusaidh) provides an excellent example of glacial activity on Arran. It also hosts hydrological features in Glen Rosa Water and Garbh Allt. </p> <img src= 'GlenRosaHillshade.PNG'/><p class='figureborder' style='text-align:center'> This diagram demonstrates the valley and the river which flows through it. </p><p> The diagram shows Glen Rosa facing North, the direction from which a glacier moved carving the valley as it went. An interesting feature here is Garbh Allt, a hanging valley to the east. This was formed as a smaller glacier eroded its valley slower than the main glacier in Glen Rosa. The result is a valley suspended above the glen.</p> <img src='GlenRosaCrossSection.png' /> <p class='figureborder' style='text-align: center'> This cross section, taken from the above map,demonstrates the U shaped valley and its height.</p> <img src='GlenRosaHydrology.PNG'/> <p class='figureborder' style='text-align:center'> Several hydrological and glacial features can be seen here. </p><p> The mound labelled as moraine marks an accumulation of debris carried and deposited by the glacier during its retreat. The moraine here provides evidence of two re/advances of the glacier.</p> <p> The river seem running through the valley is known as a misfit stream. These are rivers deemed too small to have carved the valley through which they flow and formed after glaciation.</p>")   //Add content using HTML tags 
			var gr_popup = gr.bindPopup(gr_popupContent, { 
				maxWidth: 320,				// Makes sure popups accomadate photos 
				maxHeight: 400
			});
			gr.off('click'); 
				
			//CREATE FIFTH SITE//	//Hutton's Unconformity 
			var site_five  = turf.point([-1.756068,53.792363]);               // Turf point
			let inner_geofence5 = turf.buffer(site_five, 0.05, {units:'miles', steps:32});   // Add inner buffer 
			let outer_geofence5 = turf.buffer(site_five, 0.1,{units: 'miles', steps:32});    // Add outer buffer
		    var hc = L.marker([53.792363, -1.756068], {icon: huttonsunconformity}).bindPopup("Hutton's Unconformity").addTo(map); //Add custom icon   
			L.geoJSON(inner_geofence5,{style: innerStyle}).addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence5,{style: outerStyle}).addTo(map); 				// Add outer buffer to map using style defined above
			//Create content for Huttons unconformity 
			var hc_popupContent = ("<h1> Well done! You found Huttons Unconformity! </h1><b> Dominant rock type: </b> Dalradian Schists, Carboniferous sandstone </p> <b> Period: </b> Cambrian (541-485 million years ago), Carboniferous (358-298 million years) </p> <p> Hutton's Unconformity boasts some of the oldest rocks on Arran as well as providing a scientific breakthrough for 18th centruy geologist James Hutton which helped shape our understanding of geoloigcal time. </p> <img src= 'Huttons_unconformity_geology.JPG'/> <p class='figureborder' style='text-align:center'> The change in rock type is visible on this geology map. </p><p> Arran's oldest rocks, Schists, were formed as tectonic plates collided and buckled under the pressure. The newer Carboniferous rocks were formed when sediment from the sea was deposited on top. Hutton's Unconformity consists of this gently sloping sandstone atop steeply dipping Schists. This change in rock type can be seen on the geological map. </p> <img src= 'insert_diagram_here.JPG'/> <p class='figureborder' style='text-align:center'> Diagram caption here.</p> <p>His discovery on Arran led to a better understanding of the age of the earth and paved the way for more scientific ways of thinking around earth processes.</p>")   //Add content using HTML tags 
			var hc_popup = hc.bindPopup(hc_popupContent, { 
				maxWidth: 320,				// Makes sure popups accomadate photos 
				maxHeight: 400
			});
			hc.off('click'); 
			
			//CREATE SIXTH SITE//		// Kildonan Dykes 
			var site_six  = turf.point([ -1.749965,53.790821 ]);               // Turf point
			let inner_geofence6 = turf.buffer(site_six, 0.05, {units:'miles', steps:32});   // Add inner buffer 
			let outer_geofence6 = turf.buffer(site_six, 0.1,{units: 'miles', steps:32});    // Add outer buffer
			var kd = L.marker([53.790821, -1.749965], {icon: kildonandykes}).bindPopup("Kildonan Dykes").addTo(map);  // Add custom icon
			L.geoJSON(inner_geofence6,{style: innerStyle}) .addTo(map); 										// Add inner buffer to map 
			L.geoJSON(outer_geofence6,{style: outerStyle}).addTo(map); 				// Add outer buffer to map using style defined above 
			//Create content for Kildonan Dykes 
			var kd_popupContent = ("<h1> Well done! You found Kildonan Dykes! </h1><b> Dominant rock type: </b> Basalt </p> <b> Period: </b> Palaeogene (66-23.03 million years ago) </p> <p> The southern coast of Arran around Kildonan hosts a swarm of dykes, long coloumns of black basaltic rock extending into the sea. </p><img src= 'Kildonan_dykes_geology.JPG'/> <p class='figureborder' style='text-align:center'> This geology map clearly shows the basaltic rock intersecting the surrounding sedimentary rock. </p><img src= 'Kildonan_dykes_photo.JPG' /> <p class='figureborder' style='text-align:center'> The dykes as seen from the beach. </p><p> Dykes are formed as magma rises through cracks in the crust and solidifies. These cracks were formed by the continental plates on which Arran sit moving apart, exposing magma. Like Drumadoon Sill, the dykes were fed by volcanic activity to the north of the island. However, unlike Drumadoon Sill, the dykes were formed vertically. These dykes trend predominantly North-West to South-East. </p> <img src='Aisla.JPG'/> <p class='figureborder' style='text-align:center'> Ailsa Craig off the coast of southern Arran, sits between Scotland and Ireland. </p><p> The island visible off the coast of Kildonan is known as Ailsa Craig. The island was once an active volcano and consists entirely of granite which is used in the manafacture of curling stones.</p>")   //Add content using HTML tags 
			var kd_popup = kd.bindPopup(kd_popupContent, { 
				maxWidth: 320, // Makes sure popups accomadate photos 
				maxHeight: 400
			});
			kd.off('click');

			
			// CALL LOCATION FUNCTION 		
			map.on('locationfound', onLocationFound); 
			
			// ADD FAILED GEOLOCATION FUNCTION 
			function onLocationError(e) {     // Add function in the event of failed geolocation //seems to work even if location is found ? 
				alert(e.message); 
			} 
			map.on('locationerror', onLocationError); 
			
			//ADD LEGEND 
			L.control.Legend({           // Add legend to map 
				position: "bottomright", 
				collapsed: true,      // Collapse legend into small icon to be expanded 
				legends: [{ 
					label : "Glen Rosa", 
					type: "image", 
					url: "one.png",  
				},{ 
					label: "Goatfell", 
					type: "image", 
					url: "two.png", 
				},{ 
					label: "Corrie Sandstone", 
					type: "image", 
					url: "three.png", 
				},{ 
					label: "Hutton's Unconformity", 
					type: "image", 
					url: "four.png",
				},{ 
					label: "Drumadoon Sill", 
					type: "image", 
					url: "five.png", 
				},{ 
					label: "Kildonan Dykes", 
					type: "image", 
					url: "six.png",
				}]
			}).addTo(map); 
			
	</script>
	</body>
</html>